'use strict';const cssStyles=[`
  #captcha-wrapper {
		height: 75px;
		width: 350px;
		border: 3px solid #000000;
		box-shadow: 4px 4px 2px rgba(220, 220, 220, 0.7);
		border-radius: 10px;
		padding: 10px;
		display: flex;
		align-items: center;
		justify-content: flex-start;
  }
`,`
	.captcha-image {
		position: relative;
		height: 100%;
		display: flex;
		justify-content: center;
		align-items: center;
	}
`,`
	.captcha-image > img {
    height: 53px;
    width: 135px;
	}
`,`
	.captcha-content {
		height: 100%;
		width: 100%;
	}
`,`
	.captcha-body {
		height: 50%;
		display: flex;
		justify-content: space-between;
		align-items: flex-end;
	}
`,`
	.captcha-logo {
		height: 100%;
		max-width: 80%;
	}
`,`
	.captcha-header {
		height: 50%;
		display: flex;
		justify-content: flex-start;
		align-items: center;
		margin-bottom: 3px;
	}
`,`
	.captcha-reload {
		position: absolute;
		top: 3px;
		left: 3px;
		display: flex;
		justify-content: center;
		align-items: center;
	}
`,`
	.fa.fa-redo {
		color: blue;
	}
`,`
	.captcha-input {
		border-radius: 10px;
		padding-left: 10px;
		border: 1px solid grey;
		height: 75%;
		width: 89%;
		float: left;
	}
`,`
	.captcha-status {
		float: right;
		height: 80%;
		width: 15%;
	}
`,`
	.fa.fa-circle-o-notch {
		color: blue;
		font-size: 1.5em;
	}
`,`
	.fa.fa-check {
		color: green;
		font-size: 1.5em;
	}
`,`
	.fa.fa-times {
		color: red;
		font-size: 1.5em;
  }
`,`  
  .hidden {
    display: none !important;
  }
`,`
  .blur {   
		filter: blur(3px);
  }  
`,`
	.captcha-form {
		height: 100%;
		width: 100%;
		display: flex;
		align-items: center;
	}
`],linkDependencies=[{rel:"stylesheet",href:"https://use.fontawesome.com/releases/v5.3.1/css/all.css",integrity:"sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU",crossorigin:"anonymous"},{rel:"stylesheet",href:"https://stackpath.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css",integrity:"sha384-X7L1bhgb36bF1iFvaqvhgpaGpayKM+vXNNYRlF89BFA5s3vi1qZ8EX9086RlZjy1",crossorigin:"anonymous"}],inputType="text",placeHolder="Type the answer.";function addChild(a,b,c){const d=document.createElement(b);return a.appendChild(d),c&&addClass(d,c),d}function addClass(a,b){a.classList.add(...b)}function removeClass(a,b){a.classList.remove(...b)}function removeAllClass(a){const b=a.classList;a.classList.remove(...b)}const designatedId="captcha-wrapper";function useStyleDependencies(){linkDependencies.forEach(a=>{const b=document.createElement("link");b.rel=a.rel,b.href=a.href,b.integrity=a.integrity,b.crossOrigin=a.crossorigin,document.head.appendChild(b)})}function useDefaultStyleSheet(){const a=document.createElement("style");document.head.appendChild(a),cssStyles.forEach(b=>{a.sheet.insertRule(b)})}function useDefaultStructure(a){const b=addChild(a,"div",["captcha-image"]),c=addChild(b,"img");c.alt="Something went wrong :(";const d=addChild(b,"div",["captcha-reload","hidden"]);addChild(d,"i",["fa","fa-redo"]);const e=addChild(a,"div",["captcha-content"]),f=addChild(e,"div",["captcha-header"]),g=addChild(e,"div",["captcha-body"]),h=addChild(f,"img",["captcha-logo"]);h.src="https://numcaptcha.s3.amazonaws.com/static/logo.png";const i=addChild(g,"form",["captcha-form"]),j=addChild(i,"input",["captcha-input"]);j.placeholder=placeHolder,j.type=inputType;const k=addChild(g,"div",["captcha-status"]),l=addChild(k,"i",["fa"]);return{image:c,reload:d,input:j,form:i,status:l}}function useInitialRender(){const a=document.getElementById(designatedId);if(!a)throw new Error("Please create a <div> tag with the id of 'captcha-wrapper'");if(0<a.children.length)throw new Error("Please remove contents within <div> tag");return useStyleDependencies(),useDefaultStyleSheet(),useDefaultStructure(a)}function hide(a){addClass(a,["hidden"])}function show(a){a.classList.contains("hidden")&&removeClass(a,["hidden"])}function blur(a){addClass(a,["blur"])}function unblur(a){a.classList.contains("blur")&&removeClass(a,["blur"])}function disable(a){a.setAttribute("disabled","")}function enable(a){a.removeAttribute("disabled")}function clearInput(a){a.value=""}function updateImage(a,b){a.src=b}function updateStatus(a,b){removeAllClass(a);"success"===b?addClass(a,["fa","fa-check"]):"failed"===b?addClass(a,["fa","fa-times"]):addClass(a,["fa","fa-circle-o-notch","fa-spin"])}async function getCaptcha(){const a=await fetch("http://localhost:3000");if(!a.ok)throw new Error("something went wrong..");const{id:b,image:c}=await a.json();return{id:b,image:`data:image/png;base64,${c}`}}async function submitCaptcha(a,b){const c=await fetch("http://localhost:3000/images",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:a,check:b})});if(!c.ok)throw new Error(c.status.toString());return await c.json()}const forcedReloadTime=15e3,errorThreshold=3;async function reloadCaptcha(a){a=restartIntervalInstance(a),blur(a.image),updateStatus(a.status,"pending");try{const{image:b,id:c}=await getCaptcha();a.id=c,updateImage(a.image,b)}catch(b){unblur(a.image)}return unblur(a.image),clearInput(a.input),enable(a.input),hide(a.reload),a.displayTimeoutInstance=setTimeout(()=>{show(a.reload)},5e3),a}function restartIntervalInstance(a){return a.intervalInstance&&clearInterval(a.intervalInstance),a.intervalInstance=setInterval(async()=>{a=await reloadCaptcha(a)},forcedReloadTime),a}function endCaptcha(a,b){clearInterval(a.intervalInstance),updateStatus(a.status,b),hide(a.reload.children[0])}function useNumCaptcha(){return new Promise(async(a,b)=>{let c=useInitialRender(),d=0;c=await reloadCaptcha(c),c.form.addEventListener("submit",f=>{const e=c.input.value;c.id&&!!e&&(disable(c.input),clearTimeout(c.displayTimeoutInstance),submitCaptcha(c.id,e).then(()=>(endCaptcha(c,"success"),void a(!0)),()=>(d++,d>=errorThreshold?(endCaptcha(c,"failed"),void b(!1)):void(updateStatus(c.status,"failed"),show(c.reload))))),f.preventDefault()}),c.reload.addEventListener("click",async()=>{c=await reloadCaptcha(c)})})}window.useNumCaptcha=useNumCaptcha;